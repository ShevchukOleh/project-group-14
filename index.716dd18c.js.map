{"mappings":"qhBAAA,IAAAA,EAAAC,EAAA,SAGA,MAAMC,EAAeC,SAASC,cAAc,cAC5CC,QAAQC,IAAIJ,GACZ,MAAMK,EAAUJ,SAASC,cAAc,eACjCI,EAAWL,SAASC,cAAc,UAYxC,MAAMK,EAAQ,CACZC,YAAa,EACbC,WAAY,EACZC,WAAY,KACZC,MAAO,KACPC,cAAe,KACfC,gBAAiB,MA+BnBC,eAAeC,EAAmBJ,EAAOK,GACvC,MAAMC,EAAM,IAAIC,IAAI,6CACpBD,EAAIE,aAAaC,OAAO,UAhDV,oCAiDdH,EAAIE,aAAaC,OAAO,QAAST,GACjCM,EAAIE,aAAaC,OAAO,OAAQJ,GAEhC,MAAMK,QAAiBC,MAAML,GACvBM,QAAaF,EAASG,OAE5B,OADArB,QAAQC,IAAImB,GACLA,C,CA0DTT,eAAeW,EAAcC,GAC3B,MAAMC,QAhGRb,iBACE,MAAMG,EAAM,IAAIC,IAAI,iDACpBD,EAAIE,aAAaC,OAAO,UApBV,oCAsBd,MAAMC,QAAiBC,MAAML,GAE7B,aADmBI,EAASG,QAChBG,M,CA0FSC,GACrB,OAAOF,EACJG,KACC,EAACC,YACCA,EAAWC,MACXA,EAAKC,aACLA,EAAYC,UACZA,EAASC,eACTA,EAAcC,GACdA,GACET,KACF,MAAMU,EAASN,EACX,kCAAkCA,IAClC,YACEO,EAAcL,EAChBA,EAAaM,MAAM,KAAK,GACxB,UACEC,EAAcN,EAxG5B,SAAmBO,EAASb,GAC1B,MAAMc,EAAM,GAEZ,IAAK,MAAMC,KAASf,EAAQ,CAC1B,GAAgB,QAAZa,GAAwC,IAAnBA,EAAQG,OAAc,CAC7CF,EAAIG,KAAK,SACT,K,CACSJ,EAAQK,SAASH,EAAMP,KAChCM,EAAIG,KAAKF,EAAMI,K,CAQnB,OAJIL,EAAIE,OAAS,GACfF,EAAIM,OAAO,EAAGN,EAAIE,OAAS,EAAG,SAGzBF,EAAIO,KAAK,K,CAyFNC,CAAUhB,EAAWN,GACrB,UACJ,MAAO,sCAAsCQ,iFAEtBC,iBAAsBF,gBAA6BC,gHAEnBA,+DACNA,4CACnBA,MAAOJ,EAAMmB,wGAEOf,kEACEA,MAAOI,kEACTJ,MAAOE,oFAG3C,IAGjBW,KAAK,G,CA5FVhD,EAAamD,iBAAiB,UAAUC,IACtCA,EAAEC,iBACF/C,EAASgD,UAAY,GAErB,MAAM3C,EAAQN,EAAQqC,MAGtB,GAA6B,KAAzBrC,EAAQqC,MAAMa,OAChB,OAAOpD,QAAQC,IAAI,kBAGrBW,EAAmBJ,EANR,GAOR6C,MAAKC,IACJ,MAAMC,QAAEA,EAAOC,YAAEA,GAAgBF,EAGjC,GAFAlD,EAAME,WAAakD,EAEfpD,EAAME,WAAa,EACrB,OAAOgB,EAAciC,EAAQ,IAGhCF,MAAKC,IACJnD,EAASgD,UAAYG,CAAG,IAI5B1C,EAAmBJ,EApBR,GAoBqB6C,MAAKjC,IACnC,MAAMqC,EAAQrC,EAAKsC,cACA,IAAIC,EAAAhE,GAAJ,CAAe,aAAc,CAC9CiE,WAAYH,EACZI,aAAc,GACdC,aAAc,EACdjD,KAAM,IAEGkD,GAAG,aAAaC,IAxF7BC,OAAOC,SAAS,CACdC,IAAK,EACLC,SAAU,WAwFR,MAAMvD,KAAEA,GAASmD,EACjBpD,EAAmBJ,EAAOK,GACvBwC,MAAKC,IACJ,MAAMC,QAAEA,EAAOC,YAAEA,GAAgBF,EAGjC,GAFAlD,EAAME,WAAakD,EAEfpD,EAAME,WAAa,EACrB,OAAOgB,EAAciC,EAAQ,IAGhCF,MAAKC,IACJnD,EAASgD,UAAYG,CAAG,IAI5BtD,QAAQC,IAAIY,EAAK,GACjB,GACF","sources":["src/js/search-by-keyword.js"],"sourcesContent":["import Pagination from 'tui-pagination';\nimport 'tui-pagination/dist/tui-pagination.css';\n\nconst searchFormEl = document.querySelector('.nav__form');\nconsole.log(searchFormEl);\nconst inputEl = document.querySelector('.nav__input');\nconst moviesEl = document.querySelector('.films');\n\nconst BASE_URL = 'https://api.themoviedb.org/3';\nconst API_KEY = 'c88bf135aa4e0b79b7c68835bd77599c';\n\nfunction setScrollToUp() {\n  window.scrollTo({\n    top: 0,\n    behavior: 'smooth',\n  });\n}\n\nconst state = {\n  currentPage: 1,\n  totalPages: 0,\n  activeFilm: null,\n  query: null,\n  whatPaginated: null,\n  whatchedOrQueue: null,\n};\n\nasync function fetchGenres() {\n  const url = new URL(`${BASE_URL}/genre/movie/list`);\n  url.searchParams.append('api_key', API_KEY);\n\n  const response = await fetch(url);\n  const data = await response.json();\n  return data.genres;\n}\n\nfunction getGenres(arrayId, genres) {\n  const arr = [];\n\n  for (const value of genres) {\n    if (arrayId === 'N/A' || arrayId.length === 0) {\n      arr.push('Other');\n      break;\n    } else if (arrayId.includes(value.id)) {\n      arr.push(value.name);\n    }\n  }\n\n  if (arr.length > 2) {\n    arr.splice(2, arr.length - 2, 'Other');\n  }\n\n  return arr.join(', ');\n}\n\nasync function fetchMoviesByQuery(query, page) {\n  const url = new URL(`${BASE_URL}/search/movie`);\n  url.searchParams.append('api_key', API_KEY);\n  url.searchParams.append('query', query);\n  url.searchParams.append('page', page);\n\n  const response = await fetch(url);\n  const data = await response.json();\n  console.log(data);\n  return data;\n}\n\nsearchFormEl.addEventListener('submit', e => {\n  e.preventDefault();\n  moviesEl.innerHTML = '';\n\n  const query = inputEl.value;\n  let page = 1;\n\n  if (inputEl.value.trim() === '') {\n    return console.log('порожній рядок');\n  }\n\n  fetchMoviesByQuery(query, page)\n    .then(res => {\n      const { results, total_pages } = res;\n      state.totalPages = total_pages;\n\n      if (state.totalPages > 1) {\n        return renderGallery(results);\n      }\n    })\n    .then(res => {\n      moviesEl.innerHTML = res;\n      // moviesEl.insertAdjacentHTML('beforeend', res);\n    });\n\n  fetchMoviesByQuery(query, page).then(data => {\n    const total = data.total_results;\n    const pagination = new Pagination('pagination', {\n      totalItems: total,\n      itemsPerPage: 20,\n      visiblePages: 5,\n      page: 1,\n    });\n    pagination.on('afterMove', event => {\n      setScrollToUp();\n      const { page } = event;\n      fetchMoviesByQuery(query, page)\n        .then(res => {\n          const { results, total_pages } = res;\n          state.totalPages = total_pages;\n\n          if (state.totalPages > 1) {\n            return renderGallery(results);\n          }\n        })\n        .then(res => {\n          moviesEl.innerHTML = res;\n\n          // moviesEl.insertAdjacentHTML('beforeend', res);\n        });\n      console.log(page);\n    });\n  });\n});\n\nasync function renderGallery(movies) {\n  const genres = await fetchGenres();\n  return movies\n    .map(\n      ({\n        poster_path,\n        title,\n        release_date,\n        genre_ids,\n        original_title,\n        id,\n      } = movies) => {\n        const poster = poster_path\n          ? `https://image.tmdb.org/t/p/w500${poster_path}`\n          : 'NO_POSTER';\n        const releaseYear = release_date\n          ? release_date.split('-')[0]\n          : 'Unknown';\n        const checkGenres = genre_ids\n          ? getGenres(genre_ids, genres)\n          : 'Unknown';\n        return `<li class=\"films__item\" data-mvid='${id}'>\n                  <div class=\"films__img\">\n                    <img src=${poster} alt='Poster ${original_title}'data-mvid='${id}' loading='lazy' />\n                  </div>\n                  <div class=\"films__description\" data-mvid='${id}'>\n                    <p class=\"films__title\" data-mvid='${id}'>\n                      <b data-mvid='${id}'>${title.toUpperCase()}</b>\n                    </p>\n                    <div class=\"films__meta\" data-mvid='${id}'>\n                      <p class=\"films__genres\" data-mvid='${id}'>${checkGenres}</p>\n                      <p class=\"films__data\" data-mvid='${id}'>${releaseYear}</p>\n                    </div>\n                  </div>\n                </li>`;\n      }\n    )\n    .join('');\n}\n"],"names":["$fb9GJ","parcelRequire","$c808da8250b3ec39$var$searchFormEl","document","querySelector","console","log","$c808da8250b3ec39$var$inputEl","$c808da8250b3ec39$var$moviesEl","$c808da8250b3ec39$var$state","currentPage","totalPages","activeFilm","query","whatPaginated","whatchedOrQueue","async","$c808da8250b3ec39$var$fetchMoviesByQuery","page","url","URL","searchParams","append","response","fetch","data","json","$c808da8250b3ec39$var$renderGallery","movies","genres","$c808da8250b3ec39$var$fetchGenres","map","poster_path","title","release_date","genre_ids","original_title","id","poster","releaseYear","split","checkGenres","arrayId","arr","value","length","push","includes","name","splice","join","$c808da8250b3ec39$var$getGenres","toUpperCase","addEventListener","e","preventDefault","innerHTML","trim","then","res","results","total_pages","total","total_results","$parcel$interopDefault","totalItems","itemsPerPage","visiblePages","on","event","window","scrollTo","top","behavior"],"version":3,"file":"index.716dd18c.js.map"}